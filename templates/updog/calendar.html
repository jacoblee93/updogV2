{% extends 'updog/base.html' %}

{% load static %}

{% block above_calendar_block %}

<div class="hero-unit">
  <br />
  <br />

  <center>
    <h1>What's Up, {{ user.first_name }}?</h1>
  </center>
  <br />
</div>

<script>
  $(document).ready(function() {
    $("#testForm").submit(function(event) {
        event.preventDefault();
        $.ajax({
           type: "POST",
           url: "/calendar/test_ajax/",
           success: function(data) {
              console.log( "ajax worked" );
              alert(data);
           },
        });
     });
  });
</script>

{% endblock %}

{% block calendar_block %}

<script>
function getinfo(name) {
  alert();
}
</script>

<!-- THIS IS THE CALENDAR!!! -->
<div class="span12">
  <div class="row-fluid">
    <div class="col-xs-6 col-sm-9">
      <div id='calendar'></div>
      <div class="ui-helper-hidden" id="calendar-details" title="Event Details">
        <p>Event details</p>
      </div>
    </div>

    {% if user.is_authenticated %}
      <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
        <div class="list-group">
          {% if friends_list %}
            {% for friend in friends_list %}
              <a class="list-group-item" onclick="getinfo('{{ friend }}')">
               <div><img src="{% static 'img/glyphicons-halflings.png' %}" alt = "profpic" width = "40" height = "40">
               {{ friend }}
               </div>
              </a>
            {% endfor %}
          {% else %}
            <strong>No friends.</strong>
          {% endif %}
        </div>
      </div><!--/span-->
    {% endif %}
  </div>
</div>


      <!--<label class="checkbox">
	<input type="checkbox" value="#events-modal" id="events-in-modal"> Open events in modal window
      </label>-->
      
<!--<div> <label class="checkbox">
  <input type="checkbox" value="#events-modal" id="events-in-modal"> Open events in modal window
  </label>
</div>
    
<div><h4>Events</h4>
  <small>This list is populated with events dynamically</small>
  <ul id="eventlist" class="nav nav-list"></ul>
</div>

<div class="clearfix"></div>
<br><br>
<a href="https://github.com/Serhioromano/bootstrap-calendar/issues" class="btn btn-block btn-info">
  <center>
    <span class="lead">
      Submit an issue, ask questions or give your ideas here!<br>
    </span>
    <small>Please do not post your "How to ..." questions in comments. use GitHub issue tracker.</small>
  </center>
</a>
<br><br>-->

<!-- the script to populate events in the calendar -->
<!--<ul>
{% if events_list %}
{% for event in events_list %}
<li>{{ event.start_time }}</li>
{% endfor %}
{% endif %}
</ul>-->
<div>
  <script>
    // This function converts a Date object, date, into a time of the form: 2:00 PM or 11:00 AM
    function getTime(date) {
      var local_time = date.toLocaleTimeString()
      var lt_length = local_time.length;

      return local_time.substring(0, lt_length - 6) + local_time.substring(lt_length - 3, lt_length)
    } 

    $(document).ready(function() {
      {% autoescape off %}
        var data = {{ events_list }};
      {% endautoescape %}

      if (data.length > 0) {
        var dlength = data.length;
        var multiple = [];
        
        // in each loop, we add another event to the list of events for this user
        for (var i = 0; i < dlength; i++) {
          var single = new Object();
          // If event has no activity
          if (! data[i].fields.activity) {
            if (! data[i].fields.location) {
              single.title= "Busy";
            }
            else{
              single.title= "Busy in " + data[i].fields.location;
            }
          }
          // If event has an activity
          else {
            if (! data[i].fields.location) {
              single.title= data[i].fields.activity;
            }
            else{
              single.title=data[i].fields.activity + " in " + data[i].fields.location;
            }
          }

          single.start= data[i].fields.start_time;
          single.end=data[i].fields.end_time;
          single.allDay=false;

          multiple.push(single);
        }
      }
  
    var date = new Date();
    var d = date.getDate();
    var m = date.getMonth();
    var y = date.getFullYear();

    var $dialog = $('#calendar-details').dialog({
      autoOpen: false,
      model: true,
      height: 300,
      width: 350
    });

      $('#calendar').fullCalendar({
      header: {
      left: 'prev,next today',
      center: 'title',
      right: 'month,agendaWeek,agendaDay'
      },
      editable: true,

      events: multiple,

      // Use below if you want something to happen after
      // clicking on an existing event in the calendar
      eventClick: function(event, jsEvent, view) {
        console.log(event);
        $dialog.dialog({title:event.title});
        $($dialog).empty().append(
          $('<p />').text(event.start.toDateString())
        );
        $($dialog).append(
          $('<p />').text(event.allDay ? 'All day event' : getTime(event.start) + '-' + getTime(event.end))
        );
        if (event.location)
        $($dialog).append(
          $('<p />').text(event.allDay ? 'All day event' : getTime(event.start) + '-' + getTime(event.end))
        );


        $dialog.dialog('open');
      },

      // If you click on a day, you will be alerted with its date
      dayClick: function(date, allDay, jsEvent, view) {
        console.log(date);

        $.ajax({
          type: "POST",
          url: "/calendar/",
          success: function(data) {
            {% autoescape off %}
              var data = {{ events_list }}
            {% endautoescape %}

            alert( date );

            console.log( data[0].fields.start_time );

            console.log( "ajax worked" );

          },
        });
      }
    });
    
  });
    
  </script>
<!-- this is the style they use in the example html
    <style>
    
    body {
    margin-top: 40px;
    text-align: center;
    font-size: 14px;
    font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
    }
    
    #calendar {
    width: 900px;
    margin: 0 auto;
    }

  </style>
  -->

</div>

<!-- TEST AJAX
   <form id="testForm" action="/calendar/test_ajax/" method="post">{% csrf_token %}
     <input type="submit" id="go" name="go" value="Click to Hopefully Have AJAX work!">
   </form>
-->
{% endblock %}
